<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>King Chatbot AI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
    
    <style>
        /* Estilos Personalizados que complementam o Tailwind */
        body { font-family: 'Inter', sans-serif; overflow: hidden; }
        h1, h2, .font-king { font-family: 'Cinzel', serif; }
        
        /* Scrollbar Personalizada */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #fbbf24; border-radius: 3px; }
        
        /* Animações e Efeitos */
        .particle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: #fbbf24;
            border-radius: 50%;
            opacity: 0.3;
            pointer-events: none;
            animation: floatUp linear infinite;
        }
        
        @keyframes floatUp {
            0% { transform: translateY(0) rotate(0deg); opacity: 0; }
            50% { opacity: 0.5; }
            100% { transform: translateY(-100vh) rotate(360deg); opacity: 0; }
        }

        /* Estilos das Mensagens */
        .message-king {
            background: linear-gradient(135deg, #1a1a1a 0%, #000000 100%);
            border: 1px solid #fbbf24;
            color: #fbbf24;
            box-shadow: 0 0 15px rgba(251, 191, 36, 0.1);
        }
        
        .message-user {
            background: #27272a;
            color: white;
            border: 1px solid #3f3f46;
        }

        .crown-badge {
            position: absolute;
            top: -10px;
            left: -10px;
            background: #fbbf24;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 0 10px #fbbf24;
            z-index: 20;
        }

        /* Typing Animation */
        .typing-dot {
            width: 6px;
            height: 6px;
            background: #fbbf24;
            border-radius: 50%;
            animation: typing 1.4s infinite ease-in-out both;
        }
        .typing-dot:nth-child(1) { animation-delay: -0.32s; }
        .typing-dot:nth-child(2) { animation-delay: -0.16s; }
        
        @keyframes typing {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1); }
        }

        /* Utilitários */
        .hidden { display: none !important; }
        
        /* Range Input Customizado */
        input[type=range] {
            accent-color: #fbbf24;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-slate-900 via-black to-slate-800 h-screen w-screen text-white relative">

    <div id="particles" class="absolute inset-0 z-0 pointer-events-none overflow-hidden"></div>

    <div id="loadingOverlay" class="fixed inset-0 z-50 bg-black/90 flex flex-col items-center justify-center hidden">
        <div class="animate-spin text-yellow-400 text-5xl mb-4"><i class="fas fa-circle-notch"></i></div>
        <p class="text-yellow-400 font-king tracking-widest">CARREGANDO...</p>
    </div>

    <div id="loginScreen" class="absolute inset-0 z-40 flex items-center justify-center p-4">
        <div class="bg-black/60 backdrop-blur-md p-8 rounded-3xl border border-yellow-500/30 shadow-2xl max-w-md w-full text-center crown-glow">
            <div class="text-6xl text-yellow-400 mb-6 crown-glow"><i class="fas fa-crown"></i></div>
            <h1 class="text-4xl text-yellow-400 mb-2 font-bold tracking-wider">KING AI</h1>
            <p class="text-gray-400 mb-8">Seu assistente real pessoal</p>
            <button id="loginBtn" class="w-full bg-yellow-500 hover:bg-yellow-400 text-black font-bold py-4 rounded-xl transition-all duration-300 transform hover:scale-105 shadow-[0_0_20px_rgba(234,179,8,0.5)]">
                ENTRAR NO REINO
            </button>
        </div>
    </div>

    <div id="chatScreen" class="absolute inset-0 z-10 flex flex-col hidden">
        
        <header class="bg-black/50 backdrop-blur-md border-b border-yellow-500/20 p-4 flex justify-between items-center">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 bg-yellow-500 rounded-full flex items-center justify-center crown-glow">
                    <i class="fas fa-crown text-black"></i>
                </div>
                <div>
                    <h2 class="text-yellow-400 font-bold text-lg leading-none">King AI</h2>
                    <span class="text-xs text-green-400 flex items-center gap-1">
                        <span class="w-2 h-2 bg-green-400 rounded-full animate-pulse"></span> Online
                    </span>
                </div>
            </div>
            
            <div class="flex gap-3">
                <button id="themeToggle" class="w-10 h-10 rounded-full bg-white/5 hover:bg-white/10 flex items-center justify-center transition-colors">
                    <i class="fas fa-sun text-yellow-400"></i>
                </button>
                <button id="refreshBtn" class="w-10 h-10 rounded-full bg-white/5 hover:bg-white/10 flex items-center justify-center transition-colors text-yellow-400" title="Apagar última">
                    <i class="fas fa-undo"></i>
                </button>
                <button id="settingsBtn" class="w-10 h-10 rounded-full bg-white/5 hover:bg-white/10 flex items-center justify-center transition-colors text-yellow-400">
                    <i class="fas fa-cog"></i>
                </button>
            </div>
        </header>

        <main id="chatMessages" class="flex-1 overflow-y-auto p-4 scroll-smooth">
            </main>

        <footer class="p-4 bg-black/50 backdrop-blur-md border-t border-yellow-500/20">
            <div class="flex items-end gap-2 max-w-4xl mx-auto relative">
                <textarea 
                    id="messageInput" 
                    rows="1" 
                    placeholder="Vossa Majestade, digite sua pergunta..." 
                    class="w-full bg-white/5 border border-yellow-500/30 rounded-2xl px-4 py-3 text-white focus:outline-none focus:border-yellow-500 focus:bg-white/10 resize-none max-h-32 transition-all scrollbar-hide"
                ></textarea>
                
                <button id="sendBtn" disabled class="bg-yellow-500 hover:bg-yellow-400 disabled:opacity-50 disabled:cursor-not-allowed text-black w-12 h-12 rounded-full flex items-center justify-center transition-all shadow-[0_0_15px_rgba(234,179,8,0.3)] hover:shadow-[0_0_25px_rgba(234,179,8,0.6)] mb-0.5 shrink-0">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </footer>
    </div>

    <div id="settingsPanel" class="fixed inset-0 z-50 bg-black/80 backdrop-blur-sm hidden flex justify-end">
        <div class="w-full max-w-sm bg-gray-900 h-full border-l border-yellow-500/30 p-6 shadow-2xl transform transition-transform animate-slideLeft overflow-y-auto">
            <div class="flex justify-between items-center mb-8">
                <h2 class="text-2xl text-yellow-400 font-bold">Configurações</h2>
                <button id="closeSettings" class="text-gray-400 hover:text-white"><i class="fas fa-times text-xl"></i></button>
            </div>

            <div class="mb-8">
                <label class="block text-gray-400 text-sm mb-2 font-bold">API KEY (Gemini)</label>
                <input type="password" id="apiKeyInput" class="w-full bg-black border border-gray-700 rounded-lg p-3 text-white focus:border-yellow-500 outline-none text-sm font-mono">
                <p class="text-xs text-gray-500 mt-1">Sua chave é salva apenas no seu navegador.</p>
            </div>

            <div class="mb-8">
                <div class="flex justify-between mb-2">
                    <label class="text-gray-300">Intensidade do Brilho</label>
                    <span id="glowValue" class="text-yellow-400">50%</span>
                </div>
                <input type="range" id="glowRange" min="0" max="100" class="w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer">
            </div>

            <div class="mb-8">
                <label class="block text-gray-300 mb-2">Velocidade da Resposta</label>
                <div class="relative">
                    <select id="speedSelect" class="w-full bg-black border border-gray-700 text-white p-3 rounded-lg appearance-none outline-none focus:border-yellow-500">
                        <option value="fast">Rápida (Resumida)</option>
                        <option value="normal">Normal (Padrão)</option>
                        <option value="detailed">Detalhada (Pensativa)</option>
                    </select>
                    <i class="fas fa-chevron-down absolute right-3 top-4 text-gray-400 pointer-events-none"></i>
                </div>
            </div>

            <div class="space-y-3 mt-8 border-t border-gray-800 pt-6">
                <button id="saveSettings" class="w-full bg-yellow-500 text-black font-bold p-3 rounded-lg hover:bg-yellow-400 transition">Salvar Alterações</button>
                <button id="shareBtn" class="w-full bg-gray-800 text-white font-bold p-3 rounded-lg hover:bg-gray-700 transition"><i class="fas fa-share-alt mr-2"></i>Compartilhar Conversa</button>
                <button id="saveBtn" class="w-full bg-gray-800 text-white font-bold p-3 rounded-lg hover:bg-gray-700 transition"><i class="fas fa-download mr-2"></i>Baixar Histórico</button>
                <button id="clearBtn" class="w-full bg-red-900/30 text-red-400 border border-red-900/50 font-bold p-3 rounded-lg hover:bg-red-900/50 transition mt-4">Limpar Tudo</button>
            </div>
            
            <div class="mt-8 text-center text-xs text-gray-600 font-king">
                KING AI SYSTEM v2.0
            </div>
        </div>
    </div>

    <script>
        // Configurações e Estado Global
        const CONFIG = {
            apiKey: 'AIzaSyA9a8QscXbFVLcVn6slY5ddmCHbpmQ5oFY', // Sua API Key (Cuidado ao compartilhar!)
            model: 'gemini-2.0-flash-exp',
            apiUrl: 'https://generativelanguage.googleapis.com/v1beta/models/',
            storageKeys: {
                history: 'king_chat_history',
                apiKey: 'king_api_key',
                settings: 'king_settings'
            }
        };

        let chatHistory = [];
        let isTyping = false;
        let isDarkMode = true;
        let glowIntensity = 50;
        let aiSpeed = 'normal';
        let currentApiKey = CONFIG.apiKey;

        // Elementos DOM (Mapeamento com o HTML acima)
        const elements = {
            loginScreen: document.getElementById('loginScreen'),
            chatScreen: document.getElementById('chatScreen'),
            loginBtn: document.getElementById('loginBtn'),
            chatMessages: document.getElementById('chatMessages'),
            messageInput: document.getElementById('messageInput'),
            sendBtn: document.getElementById('sendBtn'),
            themeToggle: document.getElementById('themeToggle'),
            settingsBtn: document.getElementById('settingsBtn'),
            settingsPanel: document.getElementById('settingsPanel'),
            closeSettings: document.getElementById('closeSettings'),
            refreshBtn: document.getElementById('refreshBtn'),
            saveBtn: document.getElementById('saveBtn'),
            shareBtn: document.getElementById('shareBtn'),
            clearBtn: document.getElementById('clearBtn'),
            glowRange: document.getElementById('glowRange'),
            glowValue: document.getElementById('glowValue'),
            speedSelect: document.getElementById('speedSelect'),
            apiKeyInput: document.getElementById('apiKeyInput'),
            saveSettings: document.getElementById('saveSettings'),
            loadingOverlay: document.getElementById('loadingOverlay'),
            particles: document.getElementById('particles')
        };

        // ==================== INICIALIZAÇÃO ====================

        function init() {
            loadSettings();
            loadChatHistory();
            createParticles();
            setupEventListeners();
            autoResizeTextarea();
        }

        function loadSettings() {
            const savedSettings = localStorage.getItem(CONFIG.storageKeys.settings);
            if (savedSettings) {
                const settings = JSON.parse(savedSettings);
                glowIntensity = settings.glowIntensity || 50;
                aiSpeed = settings.aiSpeed || 'normal';
                currentApiKey = settings.apiKey || CONFIG.apiKey;
                isDarkMode = settings.darkMode !== undefined ? settings.darkMode : true;
                
                elements.glowRange.value = glowIntensity;
                elements.glowValue.textContent = `${glowIntensity}%`;
                elements.speedSelect.value = aiSpeed;
                elements.apiKeyInput.value = currentApiKey;
            }
        }

        function saveSettingsToStorage() {
            const settings = {
                glowIntensity,
                aiSpeed,
                apiKey: currentApiKey,
                darkMode: isDarkMode
            };
            localStorage.setItem(CONFIG.storageKeys.settings, JSON.stringify(settings));
        }

        function loadChatHistory() {
            const saved = localStorage.getItem(CONFIG.storageKeys.history);
            if (saved) {
                chatHistory = JSON.parse(saved);
                renderChatHistory();
            } else {
                addMessage('Saudações. Eu sou o King. Como posso servi-lo hoje?', 'king');
            }
        }

        function saveChatHistory() {
            localStorage.setItem(CONFIG.storageKeys.history, JSON.stringify(chatHistory));
        }

        // ==================== EVENT LISTENERS ====================

        function setupEventListeners() {
            elements.loginBtn.addEventListener('click', handleLogin);
            
            elements.sendBtn.addEventListener('click', handleSendMessage);
            elements.messageInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    handleSendMessage();
                }
            });
            
            elements.messageInput.addEventListener('input', () => {
                autoResizeTextarea();
                elements.sendBtn.disabled = !elements.messageInput.value.trim() || isTyping;
            });
            
            elements.themeToggle.addEventListener('click', toggleTheme);
            
            elements.settingsBtn.addEventListener('click', () => {
                elements.settingsPanel.classList.remove('hidden');
            });
            
            elements.closeSettings.addEventListener('click', () => {
                elements.settingsPanel.classList.add('hidden');
            });
            
            elements.settingsPanel.addEventListener('click', (e) => {
                if (e.target === elements.settingsPanel) {
                    elements.settingsPanel.classList.add('hidden');
                }
            });
            
            elements.glowRange.addEventListener('input', (e) => {
                glowIntensity = e.target.value;
                elements.glowValue.textContent = `${glowIntensity}%`;
                updateGlowEffect();
            });
            
            elements.speedSelect.addEventListener('change', (e) => {
                aiSpeed = e.target.value;
            });
            
            elements.apiKeyInput.addEventListener('input', (e) => {
                currentApiKey = e.target.value.trim();
            });
            
            elements.saveSettings.addEventListener('click', () => {
                saveSettingsToStorage();
                elements.settingsPanel.classList.add('hidden');
                showNotification('Configurações salvas com sucesso!');
            });
            
            elements.refreshBtn.addEventListener('click', handleRefresh);
            elements.saveBtn.addEventListener('click', handleSave);
            elements.shareBtn.addEventListener('click', handleShare);
            elements.clearBtn.addEventListener('click', handleClear);
        }

        // ==================== UI ANIMATIONS ====================

        function createParticles() {
            const particleCount = window.innerWidth < 768 ? 12 : 20;
            elements.particles.innerHTML = '';
            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = `${Math.random() * 100}%`;
                particle.style.top = `${Math.random() * 100}%`;
                particle.style.animationDelay = `${Math.random() * 2}s`;
                particle.style.animationDuration = `${4 + Math.random() * 4}s`; 
                elements.particles.appendChild(particle);
            }
        }

        function showLoading() {
            elements.loadingOverlay.classList.remove('hidden');
        }

        function hideLoading() {
            elements.loadingOverlay.classList.add('hidden');
        }

        function updateGlowEffect() {
            document.querySelectorAll('.crown-glow').forEach(el => {
                el.style.filter = `drop-shadow(0 0 ${glowIntensity / 4}px rgba(251,191,36,0.6))`;
            });
        }

        function autoResizeTextarea() {
            const textarea = elements.messageInput;
            textarea.style.height = 'auto';
            const maxHeight = window.innerWidth < 768 ? 120 : 150;
            textarea.style.height = Math.min(textarea.scrollHeight, maxHeight) + 'px';
        }

        function scrollToBottom() {
            setTimeout(() => {
                elements.chatMessages.scrollTo({
                    top: elements.chatMessages.scrollHeight,
                    behavior: 'smooth'
                });
            }, 100);
        }

        // ==================== AUTHENTICATION ====================

        function handleLogin() {
            showLoading();
            setTimeout(() => {
                hideLoading();
                elements.loginScreen.classList.add('hidden');
                elements.chatScreen.classList.remove('hidden');
                elements.chatScreen.classList.remove('flex'); 
                elements.chatScreen.classList.add('flex'); 
                elements.messageInput.focus();
                scrollToBottom();
            }, 1000);
        }

        // ==================== CHAT FUNCTIONS ====================

        function addMessage(text, sender) {
            const message = {
                text,
                sender,
                id: Date.now(),
                timestamp: new Date().toISOString()
            };
            
            chatHistory.push(message);
            renderMessage(message);
            saveChatHistory();
            scrollToBottom();
        }

        function renderMessage(message) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `flex ${message.sender === 'king' ? 'justify-start' : 'justify-end'} mb-4 px-2`;
            messageDiv.dataset.id = message.id;
            
            const bubble = document.createElement('div');
            bubble.className = `relative px-4 py-3 rounded-2xl max-w-[85%] md:max-w-[70%] break-
